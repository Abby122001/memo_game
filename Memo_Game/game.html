<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Matching Game</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Comic Sans MS', cursive, sans-serif;
}

body {
background-color: #50733f;
min-height: 100vh;
padding: 20px;
display: flex;
flex-direction: column;
align-items: center;
}

.back-button {
position: absolute;
top: 20px;
left: 20px;
background: linear-gradient(145deg, #7a3b0d, #5d2a00);
border: none;
color: #f6c440;
width: 50px;
height: 50px;
border-radius: 50%;
font-size: 24px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.3s;
box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
}

.back-button:hover {
background: rgba(255,255,255,0.3);
transform: scale(1.1);
}


.game-container-wrapper {
width: 100%;
max-width: 1200px;
margin: 0 auto;
padding: 20px;
background: rgba(255, 255, 255, 0.1);
border-radius: 15px;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.game-header {
text-align: center;
margin: 0 auto 20px;
width: 100%;
max-width: 800px;
display: flex;
flex-direction: column;
align-items: center;
}

.game-header h1 {
width: 100%;
margin-bottom: 15px;
font-size: 48px;
color: #FCB53B;
text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.game-stats {
display: flex;
justify-content: space-around;
background: whitesmoke;
padding: 5px;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);

width: 100%;
max-width: 500px;
}

.stat-box {
text-align: center;
}

.stat-value {
font-size: 1.5em;
font-weight: bold;
color:#7a3b0d;
}

.stat-label {
font-size: 0.9em;
color: #666;
}

.game-container {
text-align: center;
margin: 0 auto 20px;
width: 100%;
max-width: 800px;
display: flex;
flex-direction: column;
align-items: center;
}

.game-board {
display: grid;
gap: 10px;
width: 100%;
max-width: 800px;
margin: 0 auto;
}

.card {
aspect-ratio: 1;
background: white;
border-radius: 10px;
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
font-size: 2em;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
transition: all 0.3s ease;
transform-style: preserve-3d;
position: relative;
}

.card.flipped {
transform: rotateY(180deg);
background: #4a6cf7;
color: white;
}

.card.matched {
background: #4caf50;
color: white;
cursor: default;
transform: scale(0.95);
}

.card .back {
position: absolute;
width: 100%;
height: 100%;
backface-visibility: hidden;
display: flex;
justify-content: center;
align-items: center;
border-radius: 8px;
background: linear-gradient(145deg, #ffd4a3, #dfb18f);
font-size: 1.5em;
}

.card .front {
transform: rotateY(180deg);
}

.controls {
display: flex;
justify-content: center;
gap: 20px;
margin: 30px 0;
padding: 20px 0;
}

.btn {
background: #4a6cf7;
color: white;
border: none;
padding: 10px 20px;
border-radius: 5px;
cursor: pointer;
font-size: 1em;
transition: background 0.3s ease;
margin: 0 5px;
}

.btn:hover {
background: #3a5bd9;
}

.btn-restart {
position: absolute;
background: linear-gradient(145deg, #7a3b0d, #5d2a00);
border: none;
color: #f6c440;
width: 50px;
height: 50px;
border-radius: 50%;
font-size: 24px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.3s;
box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
}

.btn-restart:hover {
background: rgba(255,255,255,0.3);
transform: scale(1.1);
}

@media (max-width: 600px) {
.game-stats {
    flex-direction: column;
    gap: 10px;
}

.card {
    font-size: 1.5em;
}
}
</style>
</head>
<body>
<div class="game-container-wrapper">
<div class="game-header">
<h1>Memory Matching Game</h1>
<div class="game-stats">
<div class="stat-box">
    <div class="stat-value" id="moves">0</div>
    <div class="stat-label">Moves</div>
</div>
<div class="stat-box">
    <div class="stat-value" id="timer">0:00</div>
    <div class="stat-label">Time</div>
</div>
<div class="stat-box">
    <div class="stat-value" id="matches">0</div>
    <div class="stat-label">Matches</div>
</div>
</div>
</div>

<div class="game-container">
<div class="game-board" id="gameBoard">
<!-- Game board will be generated by JavaScript -->
</div>
</div>

<div class="controls">
<button class="btn btn-restart" id="restartBtn">
<i class="fas fa-redo" id="restartIcon"></i>
</button>
<button class="back-button" onclick="window.history.back()">
<i class="fas fa-arrow-left"></i>
</button>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
// Game state
let cards = [];
let hasFlippedCard = false;
let lockBoard = false;
let firstCard, secondCard;
let moves = 0;
let matches = 0;
let timer = null;
let seconds = 0;
let gameStarted = false;

// Get game settings from localStorage
const gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || {
    category: 'icons',
    grid: { rows: 4, cols: 3 }
};

const { category, grid: gridSize } = gameSettings;
const totalPairs = (gridSize.rows * gridSize.cols) / 2;

// DOM elements
const gameBoard = document.getElementById('gameBoard');
const movesDisplay = document.getElementById('moves');
const matchesDisplay = document.getElementById('matches');
const timerDisplay = document.getElementById('timer');
const restartBtn = document.getElementById('restartBtn');
const backBtn = document.getElementById('backBtn');

// Initialize game
initGame();

// Event listeners
restartBtn.addEventListener('click', function() {
    const restartIcon = document.getElementById('restartIcon');
    // Add loading class and disable button
    restartIcon.className = 'fas fa-spinner fa-spin';
    restartBtn.disabled = true;
    
    // Small delay to show the loading state
    setTimeout(() => {
        initGame();
        // Restore the icon and re-enable button after game restarts
        restartIcon.className = 'fas fa-redo';
        restartBtn.disabled = false;
    }, 500); // 500ms delay to show loading state
});
backBtn.addEventListener('click', () => {
    window.location.href = 'gridselection.html';
});

function initGame() {
    // Reset game state
    cards = [];
    hasFlippedCard = false;
    lockBoard = false;
    firstCard = null;
    secondCard = null;
    moves = 0;
    matches = 0;
    seconds = 0;
    gameStarted = false;
    
    // Clear the board
    gameBoard.innerHTML = '';
    
    // Update UI
    updateMoves();
    updateMatches();
    updateTimer();
    
    // Clear existing timer
    if (timer) clearInterval(timer);
    
    // Set up the game board
    setupBoard();
}

function setupBoard() {
    // Set the grid template based on the selected size
    gameBoard.style.gridTemplateColumns = `repeat(${gridSize.cols}, 1fr)`;
    
    // Create an array of card values (pairs of numbers)
    const cardValues = [];
    for (let i = 1; i <= totalPairs; i++) {
        cardValues.push(i, i);
    }
    
    // Shuffle the cards
    const shuffledCards = shuffleArray(cardValues);
    
    // Create card elements
    shuffledCards.forEach((value, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.value = value;
        
        // Create card faces
        const back = document.createElement('div');
        back.className = 'back';
        back.innerHTML = '?'; // You can replace with an icon or leave as is
        
        const front = document.createElement('div');
        front.className = 'front';
        front.innerHTML = `<i class="fas fa-${getIconForValue(value, category)}"></i>`;
        
        card.appendChild(back);
        card.appendChild(front);
        
        card.addEventListener('click', flipCard);
        
        gameBoard.appendChild(card);
        cards.push(card);
    });
}

function flipCard() {
    if (lockBoard) return;
    if (this === firstCard) return;
    if (this.classList.contains('matched')) return;
    
    // Start the timer on first move
    if (!gameStarted) {
        startTimer();
        gameStarted = true;
    }
    
    this.classList.add('flipped');
    
    if (!hasFlippedCard) {
        // First click
        hasFlippedCard = true;
        firstCard = this;
        return;
    }
    
    // Second click
    secondCard = this;
    checkForMatch();
}

function checkForMatch() {
    const isMatch = firstCard.dataset.value === secondCard.dataset.value;
    
    if (isMatch) {
        disableCards();
        matches++;
        updateMatches();
        
        // Check for win
        if (matches === totalPairs) {
            endGame();
        }
    } else {
        unflipCards();
    }
    
    // Update moves
    moves++;
    updateMoves();
}

function disableCards() {
    firstCard.removeEventListener('click', flipCard);
    secondCard.removeEventListener('click', flipCard);
    firstCard.classList.add('matched');
    secondCard.classList.add('matched');
    resetBoard();
}

function unflipCards() {
    lockBoard = true;
    
    setTimeout(() => {
        firstCard.classList.remove('flipped');
        secondCard.classList.remove('flipped');
        resetBoard();
    }, 1000);
}

function resetBoard() {
    [hasFlippedCard, lockBoard] = [false, false];
    [firstCard, secondCard] = [null, null];
}

function startTimer() {
    timer = setInterval(() => {
        seconds++;
        updateTimer();
    }, 1000);
}

function updateMoves() {
    movesDisplay.textContent = moves;
}

function updateMatches() {
    matchesDisplay.textContent = `${matches} / ${totalPairs}`;
}

function updateTimer() {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    timerDisplay.textContent = `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}

function endGame() {
    clearInterval(timer);
    setTimeout(() => {
        alert(`Congratulations! You won in ${moves} moves and ${seconds} seconds!`);
    }, 500);
}

// Utility functions
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

function getIconForValue(value, category) {
    // Define icons for each category
    const categories = {
        animals: [
            'dog', 'cat', 'hippo', 'fish', 'frog', 'horse', 'kiwi-bird', 'otter',
            'crow', 'dove', 'dragon', 'feather', 'feather-alt', 'frog', 'hippo', 'horse-head',
            'kiwi-bird', 'otter', 'paw', 'spider', 'dove', 'crow', 'dragon', 'feather',
            'feather-alt', 'frog', 'hippo', 'horse-head', 'kiwi-bird', 'otter', 'paw', 'spider'
        ],
        icons: [
            'heart', 'star', 'bell', 'gem', 'cloud', 'moon', 'sun', 'key',
            'anchor', 'bomb', 'bone', 'gift', 'home', 'igloo', 'lemon', 'music',
            'rocket', 'shapes', 'ship', 'snowman', 'umbrella', 'volleyball-ball', 'yin-yang', 'atom',
            'bolt', 'camera', 'cookie', 'crown', 'dice', 'diamond', 'drum', 'feather'
        ],
        fruits: [
            'apple-alt', 'lemon', 'pepper-hot', 'carrot', 'leaf', 'seedling', 'pepper-hot', 'carrot',
            'lemon', 'apple-alt', 'seedling', 'leaf', 'pepper-hot', 'carrot', 'lemon', 'apple-alt',
            'seedling', 'leaf', 'pepper-hot', 'carrot', 'lemon', 'apple-alt', 'seedling', 'leaf',
            'pepper-hot', 'carrot', 'lemon', 'apple-alt', 'seedling', 'leaf', 'pepper-hot', 'carrot'
        ],
        vehicles: [
            'car', 'truck', 'truck-monster', 'truck-pickup', 'shuttle-van', 'car-side', 'truck-loading', 'truck-moving',
            'shipping-fast', 'shuttle-van', 'truck', 'truck-monster', 'truck-pickup', 'shuttle-van', 'car-side', 'truck-loading',
            'truck-moving', 'shipping-fast', 'shuttle-van', 'truck', 'truck-monster', 'truck-pickup', 'shuttle-van', 'car-side',
            'truck-loading', 'truck-moving', 'shipping-fast', 'shuttle-van', 'truck', 'truck-monster', 'truck-pickup', 'shuttle-van'
        ]
    };
    
    // Default to icons if category not found
    const icons = categories[category] || categories.icons;
    return icons[(value - 1) % icons.length];
}
});
</script>
</body>
</html>
